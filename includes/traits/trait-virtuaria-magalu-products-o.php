<?php
 defined("\101\x42\x53\x50\x41\x54\x48") || die; trait Virtuaria_Magalu_Product_Trait { private function get_sku_data($product) { $sku = array(); if ($product && $product->get_sku()) { $sku["\x69\x64\120\x72\x6f\x64\165\143\164"] = $product->get_parent_id() ? strval($product->get_parent_id()) : strval($product->get_id()); $sku["\116\x61\x6d\x65"] = $product->get_title(); $sku["\x69\144\123\153\165"] = $product->get_sku(); $sku["\104\145\x73\143\x72\x69\160\164\151\x6f\156"] = $product->get_description() ? wp_strip_all_tags($product->get_description()) : wp_strip_all_tags($product->get_short_description()); $sku["\110\x65\x69\147\150\164"] = sprintf("\45\x30\x2e\x32\146", intval($product->get_height()) / 100); $sku["\127\151\144\x74\x68"] = sprintf("\45\60\56\x32\146", intval($product->get_width()) / 100); $sku["\x4c\x65\x6e\147\x74\x68"] = sprintf("\x25\60\x2e\x32\x66", intval($product->get_length()) / 100); $sku["\x57\145\151\147\x68\x74"] = $product->get_weight(); $sku["\x53\164\x61\x74\165\x73"] = "\x70\165\142\x6c\151\x73\150" === $product->get_status(); $normal_price = $product->get_regular_price(); $sale_price = $product->get_sale_price(); if (!$sale_price) { $sale_price = $normal_price; } if (!$sku["\x44\145\163\143\x72\x69\160\164\151\x6f\156"] && $product->get_parent_id()) { $parent = wc_get_product($product->get_parent_id()); if ($parent) { $sku["\x44\145\163\x63\x72\x69\x70\x74\151\157\156"] = $parent->get_description() ? wp_strip_all_tags($parent->get_description()) : wp_strip_all_tags($parent->get_short_description()); } } $settings = get_option("\x76\x69\162\x74\165\x61\x72\x69\141\137\155\141\147\x61\x6c\165\137\x73\x65\164\x74\x69\156\147\x73"); $extra_fee = floatval(str_replace("\x2c", "\x2e", isset($settings["\x66\145\x65"]) ? $settings["\x66\x65\x65"] : 0)); if ($extra_fee > 0) { $extra_fee /= 100; $normal_price += $normal_price * $extra_fee; $sale_price += $sale_price * $extra_fee; } $sku["\120\x72\151\143\145"] = array("\114\151\x73\x74\120\x72\151\143\x65" => $normal_price, "\123\141\154\145\120\x72\x69\x63\145" => $sale_price); if ($product->managing_stock()) { $sku["\123\164\157\x63\153\x51\165\141\x6e\x74\151\164\x79"] = $product->get_stock_quantity(); } elseif ($product->is_in_stock()) { $sku["\x73\x74\x6f\x63\x6b\x51\x75\141\156\164\x69\x74\x79"] = 10; } $featured_image = get_post_meta($product->get_id(), "\137\x74\150\x75\155\142\156\141\151\154\x5f\x69\144", true); $gallery_image = get_post_meta($product->get_id(), "\x5f\160\x72\x6f\144\x75\x63\164\x5f\x69\x6d\141\147\145\137\147\x61\154\154\x65\x72\x79", true); if ($featured_image) { $image = wp_get_attachment_image_src($featured_image, "\142\151\147"); if ($image) { $sku["\115\x61\151\156\x49\155\x61\x67\x65\x55\x72\x6c"] = $image[0]; } } elseif ($product->get_parent_id()) { $sku["\x4d\x61\x69\x6e\x49\x6d\141\x67\x65\x55\162\x6c"] = get_the_post_thumbnail_url($product->get_parent_id(), "\x62\151\147"); } if ($gallery_image) { $gallery_image = explode("\x2c", $gallery_image); foreach ($gallery_image as $gallery) { $image = wp_get_attachment_image_src($gallery, "\x62\151\x67"); if ($image) { $sku["\x55\x72\154\x49\x6d\141\x67\145\x73"][] = $image[0]; } } } $sku["\141\x74\164\162\x69\x62\x75\164\x65\163"] = $this->get_sku_attributes($product); if ($product->get_parent_id()) { $variation = wc_get_formatted_variation($product, true); if ($variation) { $sku["\166\141\162\x69\141\164\x69\157\156"] = $variation; } } } return $sku; } }